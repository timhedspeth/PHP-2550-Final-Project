# PHP 2550 Final Project
## Food Borne Pathogens 

Hi! Welcome to our project page! We are a group of graduate students in the department of Biostatistics at Brown University School of Public Health. We are working on a project regarding the outbreak of foodborne illnesses in the United States. In short we attempted to apply classification methods to predict if a case is part of an outbreak, and derive models that are accessible and understandable to public health officals who may have access to and understand biological information that is avilable, regardless of their statistics background. The data we used for this analysis is from the [NCBI pathogens database](https://www.ncbi.nlm.nih.gov/pathogens/). 

Our project is currently complete, as this course ran for the Fall 2022 semester. Our analysis began by exploring the data, regarding Salmonella, E. Coli, and Campylobacter, though the data for Campylobacter was not aligned with the goals of this project, so it is not considered in our modeling. In our EDA we explored both spatial (regions of the United States) and temporal (2013-2022) trends in the number of cases of each illness, and after refinement of our goals we returned to further explore data regarding biological information. These analysese laid the ground work for us to apply statistical techniques to predict if a case was part of a food borne illness outbreak. We were able to create Risk score models and Classification trees using information from 2013. to 2018 and these models were evaulated on a test set for 2019 to 2022. Our models are a good first step in an effort to create tools for public health officals and lay the groundwork for the development of similar models, and if you're interested please read our final report. 

## Guide to repositories and code  

### Initital Work 

This project uses the [R programing language, version 4.1.3](https://www.r-project.org/) while also requiring the use of [Rstudio](https://www.rstudio.com/) with typesetting done in [LaTeX via overleaf](https://www.overleaf.com/login). 

The first scripts used are: [Salomella_LocationClean.R](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Initial%20work/Salmonella_LocationClean.R), [campyobacter_LocationClean.R](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Initial%20work/campylobacter_LocationClean.R), and [ecoli_LocationClean.R](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Initial%20work/ecoli_LocationClean.R) which are used to reduce our data to observations that are from the United States. We next found it pertient to reduce the levels of the *Isolation_source* variable to fewer levels so that they can be used in analysis, this is achieved with the [source_groups.R](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Initial%20work/source_groups.R) script. We lastly found issues regarding the *Colection.date* variable, which required cleaning for use in analysis, which is done in the [Clean_dates.R](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Initial%20work/Clean_dates.R) file. We did consider imputation of the *Collection.date* using *Creation.date*, though as we found in a [supplementary analysis](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Supplementary/date_impute.R) that imputation was not a fesiable option. For the goals of our analysis we needed to be able to define an outbreak, which in our case was dependent on the number of cases from a single *SNP.cluster* on a monthly basis we created a function to add outbreaks, [functions_outbreaks_and_lasso.R](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Methods/functions_outbreaks_and_lasso.R).  

With most of the preprocessing completed we next moved to the exploratory phase of our analysis. The script file used for the initial analysis is [EDA_updated.R](
https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Initial%20work/EDA.R). We also explored the data a little more after we refined our question and this is avilable in [Exploratory data analysis; outbreak focused .R](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Initial%20work/Exploratory%20data%20analysis%3B%20outbreak%20focused%20.R). 


### Methods 

We next moved into the modeling phase of this project, in addition to our main question regarding outbreaks we also explored seasonality through harmonic regression, which produced null results and is attached as a suplementary file, [harmonic_regression.R](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Supplementary/harmonic_regression.R). Before we were able to move to the modeling of cases in an outbreak we had to do further pre-processing, to reduce the large number of levels and drop variables that did not have enough unique levels to be considered, done in [updated_preprocessing .R](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Methods/updated_preprocessing%20.R), this script requires the use of the function developed in [compress_leves.R](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Methods/compress_levels.R), which compresses the level of a factor to its top 7 levels and "Other" for cases where there are at least 10 observations in the top level. With the data *mostly* releveled we moved to the modeling stage, using the files [final_ecoli.csv](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Data/final_ecoli.csv) and [final_salmonella.csv](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Data/final_salmonella.csv). We added an outbreak to these datasets using our [functions_outbreaks_and_lasso.R](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Methods/functions_outbreaks_and_lasso.R) script and the levels of *SNP.cluster* were reduced using [compress_leves.R](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Methods/compress_levels.R). With the data cleaned we performed Lasso regularized Logistic regression using 12 fold cross validation called from the [functions_outbreaks_and_lasso.R](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Methods/functions_outbreaks_and_lasso.R) to derive coefficents which were divided by the median no-zer coefficent to derive a risk score model. Following this Classification trees to predict outbreaks were fit using the rpart package, and the trees were pruned to avoid overfitting. These models were assesed with the withheld test set using the AUC, Brier scores, accuracy, sensitivity, and specificity. Lastly for the Risk score models we created tables to assess what percent of cases with a given score are clasffied as an outbreak. All of these models and methods are avilable in [Models_and_results_for_final_report.Rmd](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Methods/Models_and_results_for_final_report.Rmd) (for just code [code_models_final.R](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Methods/code_models_final.R)) and to view the results you can look at [Models_and_results_for_final_report.pdf](https://github.com/timhedspeth/PHP-2550-Final-Project/blob/main/Methods/Models_and_results_for_final_report.pdf). 

## Results 

Briefly all of our models have AUC greater than .5, and Brier scores less than .2 on the testing data, indicating that the models have relatively good calibration and discrimation, though the models suffer from low specificity in the test set. The best model overall, in terms of the aforementioned metric, is the risk score model for E. Coli. To learn more about what we discovered and our conclusions you can read our report. 




If you have any questions please feel to reach out:

anthony_girard1@brown.edu 

timothy_hedspeth@brown.edu

yutong_li1@brown.edu 
